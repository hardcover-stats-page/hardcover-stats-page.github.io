{% extends "base.html" %}
{% block title %}Reading Dashboard{% endblock %}

{% macro stars(n) -%}
  {% if n %}
    <span class="stars">
      {% for _ in range(n) %}★{% endfor %}
    </span>
  {% endif %}
{%- endmacro %}

{% block content %}
<header class="header">
  <div class="profile">
    {% if me.avatar %}
      <img class="avatar" src="{{ me.avatar }}">
    {% else %}
      <div class="avatar placeholder">?</div>
    {% endif %}
    <div>
      <div class="profile-name">{{ me.name }}</div>
      <div class="muted">@{{ me.username }}</div>
      <a class="link" href="{{ me.profile_url }}" target="_blank">Hardcover Profil</a>
    </div>
  </div>

  <div class="stats">
    <div class="card">
      <div class="label">Finished (gesamt)</div>
      <div class="value">{{ finished_count }}</div>
    </div>

    <div class="card">
      <div class="label">Goal</div>
      <div class="value">{{ stats.goal_progress }}/{{ stats.goal_total }}</div>
      <div class="muted">{{ "%.1f"|format(stats.goal_pct) }}%</div>
    </div>

    <div class="card">
      <div class="label">Monthly streak</div>
      <div class="value">{{ stats.streak_monthly_current }}</div>
      <div class="muted">best {{ stats.streak_monthly_best }}</div>
    </div>
  </div>
</header>

<section class="section">
  <h2>Currently Reading</h2>

  <div class="grid">
    {% for b in currently %}
      <a class="bookcard" href="{{ b.hardcover_book_url }}" target="_blank">
        <div class="cover">
          {% if b.cover %}
            <img src="{{ b.cover }}">
          {% else %}
            <div class="nocover">No Cover</div>
          {% endif %}
        </div>
        <div class="bookmeta">
          <div class="title">{{ b.title }}</div>
          <div class="muted">{{ b.author }}</div>
          <div class="chips">
            {% if b.pages %}
              <span class="chip">{{ b.progress }}/{{ b.pages }}</span>
            {% endif %}
            {% if b.pct is not none %}
              <span class="chip">{{ b.pct }}%</span>
            {% endif %}
            {{ stars(b.rating_stars) }}
          </div>
        </div>
      </a>
    {% endfor %}
  </div>
</section>

<section class="section">
  <h2>Books per Year</h2>
  <div class="card">
    {% for row in books_per_year %}
      <div>{{ row.year }} – {{ row.count }}</div>
    {% endfor %}
  </div>
</section>

<footer class="footer muted">
  Build: {{ build.stamp }} · <a href="/build.json" target="_blank">build.json</a>
</footer>
{% endblock %}
